<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>å¼º-é‡‘ Â· iOS App ä½œå“é›†</title>
  <meta name="description" content="å¼º-é‡‘ iOS å¼€å‘è€…ä½œå“é›†ï¼Œå±•ç¤ºå…¨éƒ¨ä¸Šçº¿ Appï¼Œæ”¯æŒä¸€é”®è·³è½¬ App Store ä¸‹è½½ã€‚" />
  <link rel="preconnect" href="https://is3-ssl.mzstatic.com" />
  <style>
    :root {
      --bg: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #111827 100%);
      --card: rgba(255, 255, 255, 0.06);
      --border: rgba(255, 255, 255, 0.08);
      --text: #e2e8f0;
      --muted: #94a3b8;
      --primary: #38bdf8;
      --primary-strong: #0ea5e9;
      --shadow: 0 20px 60px rgba(0, 0, 0, 0.35);
      --radius: 16px;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'SF Pro Display', 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      padding: 32px 20px 48px;
      letter-spacing: 0.2px;
    }
    a { color: inherit; text-decoration: none; }
    .container { max-width: 1200px; margin: 0 auto; display: flex; flex-direction: column; gap: 24px; }
    .glass {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      backdrop-filter: blur(12px);
    }
    .hero {
      padding: 26px;
      display: grid;
      grid-template-columns: 1.6fr 1fr;
      gap: 24px;
      align-items: center;
    }
    .hero h1 { font-size: 32px; font-weight: 800; margin-bottom: 10px; }
    .hero p { color: var(--muted); line-height: 1.6; }
    .hero-actions { margin-top: 18px; display: flex; gap: 12px; flex-wrap: wrap; }
    .btn {
      padding: 12px 16px;
      border-radius: 12px;
      border: 1px solid var(--border);
      background: rgba(255, 255, 255, 0.04);
      color: var(--text);
      font-weight: 600;
      cursor: pointer;
      transition: all 0.25s ease;
    }
    .btn:hover { border-color: rgba(56, 189, 248, 0.6); transform: translateY(-1px); }
    .btn-primary { background: linear-gradient(135deg, var(--primary) 0%, var(--primary-strong) 100%); color: #0b1220; border: none; box-shadow: 0 12px 28px rgba(56, 189, 248, 0.35); }
    .stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 12px; }
    .stat {
      padding: 12px 14px;
      border-radius: 12px;
      background: rgba(255, 255, 255, 0.04);
      border: 1px solid var(--border);
      display: flex;
      flex-direction: column;
      gap: 4px;
    }
    .stat .label { color: var(--muted); font-size: 13px; }
    .stat .value { font-size: 20px; font-weight: 700; }
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 16px;
    }
    .card { padding: 16px; display: flex; flex-direction: column; gap: 12px; }
    .app-header { display: flex; gap: 12px; align-items: center; }
    .app-icon { width: 64px; height: 64px; border-radius: 14px; border: 1px solid var(--border); object-fit: cover; background: rgba(255,255,255,0.08); }
    .app-title { font-weight: 700; font-size: 16px; }
    .badge { padding: 4px 8px; border-radius: 999px; background: rgba(56, 189, 248, 0.12); color: #8bd9ff; font-size: 12px; border: 1px solid rgba(56, 189, 248, 0.35); }
    .desc { color: var(--muted); line-height: 1.5; font-size: 14px; }
    .meta { display: flex; gap: 10px; flex-wrap: wrap; color: var(--muted); font-size: 12px; }
    .meta span { display: inline-flex; align-items: center; gap: 4px; }
    .preview-imgs { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 8px; }
    .preview-imgs img { width: 100%; border-radius: 10px; border: 1px solid var(--border); object-fit: cover; aspect-ratio: 3/5; background: rgba(255,255,255,0.05); }
    .card-actions { display: flex; gap: 10px; flex-wrap: wrap; }
    .pill { padding: 6px 10px; border-radius: 10px; background: rgba(255,255,255,0.05); border: 1px solid var(--border); color: var(--muted); font-size: 12px; }
    .list-header { display: flex; justify-content: space-between; align-items: center; padding: 0 6px; }
    .search-box { display: flex; align-items: center; gap: 8px; padding: 10px 12px; background: rgba(255,255,255,0.05); border-radius: 12px; border: 1px solid var(--border); }
    .search-box input { background: transparent; border: none; outline: none; color: var(--text); width: 180px; }
    .footer { text-align: center; color: var(--muted); font-size: 13px; padding: 12px; }
    @media (max-width: 900px) { .hero { grid-template-columns: 1fr; } }
  </style>
</head>
<body>
  <div class="container">
    <section class="hero glass">
      <div>
        <p class="badge">iOS ç‹¬ç«‹å¼€å‘è€… Â· å¼º-é‡‘</p>
        <h1>App ä½œå“é›†ä¸ä¸‹è½½å…¥å£</h1>
        <div class="hero-actions">
          <a class="btn btn-primary" id="developerLink" target="_blank" rel="noreferrer">å‰å¾€ App Store å¼€å‘è€…é¡µ</a>
        </div>
        <div class="hero-actions stats" style="margin-top:16px;">
          <div class="stat"><span class="label">ä¸Šæ¶ App æ•°</span><span class="value" id="statCount">-</span></div>
          <div class="stat"><span class="label">å¹³å‡è¯„åˆ†</span><span class="value" id="statRating">-</span></div>
          <div class="stat"><span class="label">ç´¯è®¡è¯„åˆ†æ•°</span><span class="value" id="statRatingCount">-</span></div>
          <div class="stat"><span class="label">æœ€æ–°ç‰ˆæœ¬æ—¶é—´</span><span class="value" id="statRecent">-</span></div>
        </div>
      </div>
    </section>

    <section class="glass" style="padding:18px; display:flex; flex-direction:column; gap:16px;">
      <div class="list-header">
        <h2 style="font-size:18px; font-weight:800;">å…¨éƒ¨ App</h2>
        <div class="search-box">
          <span style="color:var(--muted);">ğŸ”</span>
          <input id="searchInput" type="text" placeholder="æœç´¢åç§°ã€ç±»åˆ«ã€å…³é”®è¯" />
        </div>
      </div>
      <div id="appsGrid" class="grid"></div>
      <div id="emptyState" style="display:none; text-align:center; color:var(--muted); padding:20px;">æœªæ‰¾åˆ°åŒ¹é…çš„ App</div>
    </section>

    <p class="footer">Â© <span id="year"></span> å¼º-é‡‘ Â· iOS å¼€å‘è€…</p>
  </div>

  <script>
    const developerId = '595674769';
    const featuredAppId = '595674666'; // æä¾›çš„é“¾æ¥
    const developerUrl = 'https://apps.apple.com/cn/developer/%E5%BC%BA-%E9%87%91/id595674769';

    const state = { apps: [], loading: false, error: null, query: '' };
    const els = {
      grid: document.getElementById('appsGrid'),
      empty: document.getElementById('emptyState'),
      search: document.getElementById('searchInput'),
      year: document.getElementById('year'),
      statCount: document.getElementById('statCount'),
      statRating: document.getElementById('statRating'),
      statRatingCount: document.getElementById('statRatingCount'),
      statRecent: document.getElementById('statRecent'),
      developerLink: document.getElementById('developerLink')
    };

    els.year.textContent = new Date().getFullYear();
    els.developerLink.href = developerUrl;

    function formatPrice(price, currency) {
      if (price === 0) return 'å…è´¹';
      const symbol = currency === 'CNY' ? 'Â¥' : '';
      return `${symbol}${price}`;
    }

    function formatDate(dateStr) {
      const d = new Date(dateStr);
      if (!dateStr || isNaN(d)) return '-';
      return d.toLocaleDateString('zh-CN');
    }

    function calcStats(apps) {
      if (!apps.length) return { count: 0, avg: '-', total: '-', recent: '-' };
      const count = apps.length;
      const rated = apps.filter(a => a.averageUserRating && a.userRatingCount);
      const avg = rated.length ? (rated.reduce((s, a) => s + a.averageUserRating, 0) / rated.length).toFixed(1) : '-';
      const total = rated.reduce((s, a) => s + a.userRatingCount, 0);
      const recentDate = apps.map(a => a.currentVersionReleaseDate || a.releaseDate).filter(Boolean).sort((a, b) => new Date(b) - new Date(a))[0];
      return { count, avg, total: total ? total.toLocaleString('zh-CN') : '-', recent: formatDate(recentDate) };
    }

    function render(apps) {
      els.grid.innerHTML = '';
      if (!apps.length) {
        els.empty.style.display = 'block';
        return;
      }
      els.empty.style.display = 'none';
      apps.forEach(app => {
        const card = document.createElement('article');
        card.className = 'card glass';
        const screenshots = app.screenshotUrls?.slice(0, 3) || [];
        const priceLabel = formatPrice(app.price, app.currency);
        const rating = app.averageUserRating ? `${app.averageUserRating.toFixed(1)} â˜… (${(app.userRatingCount || 0).toLocaleString('zh-CN')})` : 'æš‚æ— è¯„åˆ†';
        const genres = [app.primaryGenreName, ...(app.genres || []).slice(1)].filter(Boolean).slice(0, 3).join(' Â· ');
        card.innerHTML = `
          <div class="app-header">
            <img class="app-icon" src="${app.artworkUrl100}" alt="${app.trackName}" loading="lazy" />
            <div style="flex:1;">
              <div class="app-title">${app.trackName}</div>
              <div class="meta" style="margin-top:4px;">
                <span>â­ ${rating}</span>
                <span>ğŸ’° ${priceLabel}</span>
                <span>ğŸ“‚ ${genres || 'App'}</span>
              </div>
            </div>
            <span class="badge">${app.version ? 'v' + app.version : 'App'}</span>
          </div>
          <p class="desc">${app.description ? app.description.slice(0, 120) + (app.description.length > 120 ? 'â€¦' : '') : 'ä¸°å¯Œçš„åº”ç”¨ä½“éªŒï¼Œç‚¹å‡»æŸ¥çœ‹è¯¦æƒ…ã€‚'}</p>
          <div class="meta">
            <span>ğŸ“… ä¸Šæ¶ï¼š${formatDate(app.releaseDate)}</span>
            <span>â±ï¸ æ›´æ–°ï¼š${formatDate(app.currentVersionReleaseDate)}</span>
            ${app.fileSizeBytes ? `<span>ğŸ“¦ ä½“ç§¯ï¼š${(app.fileSizeBytes/1024/1024).toFixed(1)} MB</span>` : ''}
            ${app.contentAdvisoryRating ? `<span>âš–ï¸ åˆ†çº§ï¼š${app.contentAdvisoryRating}</span>` : ''}
          </div>
          ${screenshots.length ? `<div class="preview-imgs">${screenshots.map(url => `<img src="${url}" alt="${app.trackName} æˆªå›¾" loading="lazy" />`).join('')}</div>` : ''}
          <div class="card-actions">
            <a class="btn btn-primary" href="${app.trackViewUrl}" target="_blank" rel="noreferrer">App Store ä¸‹è½½</a>
            <button class="btn" onclick="navigator.clipboard.writeText('${app.trackViewUrl}').then(()=>{this.textContent='å·²å¤åˆ¶'; setTimeout(()=>this.textContent='å¤åˆ¶é“¾æ¥',1600);})">å¤åˆ¶é“¾æ¥</button>
            <span class="pill">å¼€å‘è€…ï¼š${app.artistName}</span>
          </div>
        `;
        els.grid.appendChild(card);
      });
    }

    function applyFilter() {
      const q = state.query.toLowerCase();
      const apps = state.apps.filter(app => {
        const hay = [app.trackName, app.description, app.primaryGenreName, (app.genres||[]).join(' ')].join(' ').toLowerCase();
        return hay.includes(q);
      });
      render(apps);
    }

    async function fetchApps() {
      state.loading = true;
      try {
        const res = await fetch(`https://itunes.apple.com/lookup?id=${developerId}&entity=software&country=cn`);
        const data = await res.json();
        const apps = (data.results || []).filter(item => item.kind === 'software');
        // ç¡®ä¿æä¾›çš„å• app ä¹Ÿåœ¨åˆ—è¡¨
        const single = await fetchSingle(featuredAppId);
        const merged = mergeApps(apps, single ? [single] : []);
        state.apps = merged.sort((a, b) => new Date(b.releaseDate) - new Date(a.releaseDate));
        const stats = calcStats(state.apps);
        els.statCount.textContent = stats.count;
        els.statRating.textContent = stats.avg;
        els.statRatingCount.textContent = stats.total;
        els.statRecent.textContent = stats.recent;
        applyFilter();
      } catch (err) {
        console.error(err);
        state.apps = [];
        render([]);
      } finally {
        state.loading = false;
      }
    }

    async function fetchSingle(appId) {
      try {
        const res = await fetch(`https://itunes.apple.com/lookup?id=${appId}&country=cn`);
        const data = await res.json();
        return data.results?.find(r => r.kind === 'software');
      } catch (e) {
        console.warn('å• App è·å–å¤±è´¥', e);
        return null;
      }
    }

    function mergeApps(apps, extra) {
      const map = new Map();
      [...apps, ...extra].forEach(app => { if (app && app.trackId) map.set(app.trackId, app); });
      return Array.from(map.values());
    }

    els.search.addEventListener('input', (e) => { state.query = e.target.value.trim(); applyFilter(); });

    // init
    fetchApps();
  </script>
</body>
</html>
